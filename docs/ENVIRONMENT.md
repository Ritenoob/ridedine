# Environment Variables Guide

## Overview

This document describes all environment variables used across the monorepo. Never commit actual values to git - use `.env.example` files as templates.

## Mobile App (`apps/mobile`)

Create `apps/mobile/.env` from `.env.example`:

```bash
# Supabase
EXPO_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
EXPO_PUBLIC_SUPABASE_ANON_KEY=your-anon-key-here

# Google Maps (Optional - for maps functionality)
EXPO_PUBLIC_GOOGLE_MAPS_API_KEY=your-google-maps-api-key
```

### Getting Supabase Credentials
1. Go to https://supabase.com/dashboard
2. Select your project
3. Settings → API
4. Copy Project URL and anon/public key

### Getting Google Maps API Key
1. Go to Google Cloud Console
2. Enable Maps SDK for iOS and Android
3. Create API key
4. Restrict to your app bundle IDs

## Admin Dashboard (`apps/admin`)

Create `apps/admin/.env.local` from `.env.example`:

```bash
# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key-here
```

For production (Vercel):
- Add these variables in Vercel dashboard
- Project Settings → Environment Variables

## Supabase Backend (`backend/supabase`)

### Local Development

Create `backend/supabase/.env`:

```bash
# Supabase (auto-generated by supabase init)
SUPABASE_URL=http://localhost:54321
SUPABASE_ANON_KEY=generated-local-key

# Stripe (for Edge Functions)
STRIPE_SECRET_KEY=sk_test_your_test_key
STRIPE_PUBLISHABLE_KEY=pk_test_your_test_key
STRIPE_WEBHOOK_SECRET=whsec_test_your_webhook_secret

# App URL (for redirect URLs)
APP_URL=http://localhost:8081
```

### Production (Supabase Secrets)

Set secrets via Supabase CLI or Dashboard:

```bash
# Using CLI
supabase secrets set STRIPE_SECRET_KEY=sk_live_...
supabase secrets set STRIPE_PUBLISHABLE_KEY=pk_live_...
supabase secrets set STRIPE_WEBHOOK_SECRET=whsec_...
supabase secrets set APP_URL=https://your-app-url.com
```

### Getting Stripe Keys
1. Go to https://dashboard.stripe.com
2. Developers → API keys
3. Use test keys for development
4. Use live keys for production (activate account first)

### Setting up Stripe Webhook
1. Stripe Dashboard → Developers → Webhooks
2. Add endpoint: `https://your-project.supabase.co/functions/v1/webhook_stripe`
3. Select events:
   - checkout.session.completed
   - payment_intent.succeeded
   - payment_intent.payment_failed
   - account.updated
   - charge.refunded
4. Copy webhook signing secret

## Environment Variable Security

### ✅ Safe to Expose (Client-side)
- `EXPO_PUBLIC_*` - Expo public variables
- `NEXT_PUBLIC_*` - Next.js public variables
- Supabase anon/public key (RLS protects data)
- Google Maps API key (restricted by bundle ID)

### ❌ Never Expose (Server-side only)
- Supabase service role key
- Stripe secret key
- Stripe webhook secret
- Database connection strings
- Any API keys without proper restrictions

## Development vs Production

### Development
```bash
# Mobile
EXPO_PUBLIC_SUPABASE_URL=http://localhost:54321
EXPO_PUBLIC_SUPABASE_ANON_KEY=local-anon-key

# Admin
NEXT_PUBLIC_SUPABASE_URL=http://localhost:54321
NEXT_PUBLIC_SUPABASE_ANON_KEY=local-anon-key
```

### Production
```bash
# Mobile
EXPO_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
EXPO_PUBLIC_SUPABASE_ANON_KEY=prod-anon-key

# Admin  
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=prod-anon-key
```

## Testing Credentials

For local testing without Stripe:
```bash
# Use Stripe test mode
STRIPE_SECRET_KEY=sk_test_...
STRIPE_PUBLISHABLE_KEY=pk_test_...

# Test card numbers
# Success: 4242 4242 4242 4242
# Decline: 4000 0000 0000 0002
```

## CI/CD Secrets

### GitHub Actions
Add these as repository secrets:
- Not needed for MVP (no automated deployment yet)

### Vercel (Admin Dashboard)
Add in project settings:
- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`

### EAS (Mobile Deployment)
Add to `eas.json` or use EAS secrets:
```bash
eas secret:create --scope project --name EXPO_PUBLIC_SUPABASE_URL --value your-url
eas secret:create --scope project --name EXPO_PUBLIC_SUPABASE_ANON_KEY --value your-key
```

## Troubleshooting

### "Invalid API key" errors
- Check URL matches your Supabase project
- Verify anon key is copied correctly
- Ensure no extra whitespace

### Stripe webhook failures
- Verify webhook secret matches Stripe dashboard
- Check endpoint URL is correct
- Ensure HTTPS in production

### CORS errors
- Supabase: Add app URL to allowed origins
- Local dev: Use localhost with correct port

## Quick Setup Checklist

- [ ] Create Supabase project
- [ ] Copy Supabase URL and anon key
- [ ] Create Stripe account
- [ ] Get Stripe API keys (test mode)
- [ ] Setup Stripe webhook
- [ ] Create `.env` files from examples
- [ ] Add environment variables to Vercel
- [ ] Test mobile app can connect to Supabase
- [ ] Test admin can authenticate
- [ ] Verify Stripe test payment works
