<!-- Chef Detail & Menu Page -->
<header class="header">
  <div class="header__brand">
    <img src="/assets/logo.png" alt="RideNDine" onerror="this.style.display='none'">
    <h1>RideNDine</h1>
  </div>
  <nav class="header__nav">
    <a onclick="navigateTo('/')" style="cursor: pointer;">Home</a>
    <a onclick="navigateTo('/chefs')" style="cursor: pointer;">Browse Chefs</a>
    <a onclick="navigateTo('/cart')" style="cursor: pointer;">Cart (<span id="cart-count">0</span>)</a>
  </nav>
</header>

<div style="padding: 40px 6vw;">
  <!-- Chef Header -->
  <div style="background: #ffffff; border-radius: 24px; padding: 28px; box-shadow: 0 18px 40px rgba(15, 30, 60, 0.08); margin-bottom: 32px;">
    <button class="button button--ghost" onclick="navigateTo('/chefs')" style="margin-bottom: 20px;">
      ‚Üê Back to Chefs
    </button>
    <div style="display: flex; gap: 24px; align-items: start; flex-wrap: wrap;">
      <div style="font-size: 5rem;">üçú</div>
      <div style="flex: 1; min-width: 250px;">
        <h1 id="chef-name" style="margin: 0 0 8px 0;">Chef Name</h1>
        <p id="chef-description" style="color: var(--muted); line-height: 1.6; margin: 0;">
          Loading chef information...
        </p>
        <div style="margin-top: 16px;">
          <span style="background: #f3f9f8; padding: 8px 14px; border-radius: 999px; font-weight: 600; color: var(--teal-dark);">
            ‚≠ê <span id="chef-rating">4.9</span> (<span id="chef-reviews">0</span> reviews)
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Menu Items -->
  <div style="background: #ffffff; border-radius: 24px; padding: 28px; box-shadow: 0 18px 40px rgba(15, 30, 60, 0.08);">
    <h2 style="margin-top: 0;">Menu</h2>
    <div id="menu-grid" style="display: grid; gap: 20px; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));">
      <!-- Menu items will be loaded here -->
    </div>
    <div id="menu-loading" style="text-align: center; padding: 40px; color: var(--muted);">
      Loading menu...
    </div>
  </div>

  <!-- Cart Preview -->
  <div id="cart-preview" style="position: fixed; bottom: 20px; right: 20px; background: var(--orange); color: white; padding: 16px 24px; border-radius: 999px; box-shadow: 0 10px 30px rgba(255, 122, 24, 0.4); cursor: pointer; display: none; font-weight: 600; z-index: 100;" onclick="navigateTo('/cart')">
    üõí View Cart (<span id="cart-preview-count">0</span> items) - $<span id="cart-preview-total">0.00</span>
  </div>
</div>

<script>
  (async function() {
    // Get chef slug from URL (passed via params)
    const urlParams = new URLSearchParams(window.location.search);
    const pathParts = window.location.pathname.split('/');
    const chefSlug = pathParts[pathParts.length - 1] || urlParams.get('chef') || 'hoang-gia-pho';
    
    // Load chef data from API
    try {
      const chef = await window.ChefsService.getChefBySlug(chefSlug);
      
      if (!chef) {
        document.getElementById('menu-loading').innerHTML = `
          <div style="text-align: center; padding: 60px 20px;">
            <div style="font-size: 5rem; margin-bottom: 16px;">üòï</div>
            <h2>Chef Not Found</h2>
            <p style="color: var(--muted);">We couldn't find this chef. Please try another one.</p>
            <button class="button button--primary" onclick="navigateTo('/chefs')">Browse Chefs</button>
          </div>
        `;
        return;
      }

      // Update chef header
      document.getElementById('chef-name').textContent = chef.name;
      document.getElementById('chef-description').textContent = chef.description || `Delicious ${chef.specialty} cuisine`;
      document.getElementById('chef-rating').textContent = chef.rating.toFixed(1);
      document.getElementById('chef-reviews').textContent = chef.totalOrders || '0';

      // Render menu
      const menuGrid = document.getElementById('menu-grid');
      const menuLoading = document.getElementById('menu-loading');
      
      if (!chef.menu || chef.menu.length === 0) {
        menuLoading.innerHTML = '<p style="text-align: center; color: var(--muted);">No menu items available</p>';
        return;
      }

      // Group menu by category
      const menuByCategory = chef.menu.reduce((acc, item) => {
        const category = item.category || 'Other';
        if (!acc[category]) acc[category] = [];
        acc[category].push(item);
        return acc;
      }, {});

      // Render by category
      menuGrid.innerHTML = '';
      Object.entries(menuByCategory).forEach(([category, items]) => {
        const categorySection = document.createElement('div');
        categorySection.style.gridColumn = '1 / -1';
        categorySection.innerHTML = `<h3 style="margin: 20px 0 12px 0; color: var(--teal); border-bottom: 2px solid var(--teal); padding-bottom: 8px;">${category}</h3>`;
        menuGrid.appendChild(categorySection);

        items.forEach(item => {
          const itemCard = document.createElement('div');
          itemCard.className = 'info-card';
          itemCard.style.cssText = 'display: flex; flex-direction: column;';
          itemCard.innerHTML = `
            <h4 style="margin: 0 0 8px 0; font-size: 1.1rem;">${item.name}</h4>
            <p style="color: var(--muted); line-height: 1.5; margin: 0 0 12px 0; flex: 1; font-size: 0.9rem;">
              ${item.description || ''}
            </p>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: auto;">
              <strong style="font-size: 1.2rem; color: var(--teal);">$${parseFloat(item.price).toFixed(2)}</strong>
              <button 
                class="button button--primary add-to-cart-btn" 
                data-item='${encodeURIComponent(JSON.stringify(item))}'
                style="padding: 8px 16px; font-size: 0.9rem;"
              >
                Add to Cart
              </button>
            </div>
          `;
          menuGrid.appendChild(itemCard);
        });
      });

      menuLoading.style.display = 'none';

      // Attach event listeners to add-to-cart buttons
      document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const item = JSON.parse(decodeURIComponent(this.getAttribute('data-item')));
          addToCart(chef, item);
        });
      });

    } catch (error) {
      console.error('Error loading chef:', error);
      document.getElementById('menu-loading').innerHTML = `
        <p style="text-align: center; color: var(--muted);">Error loading menu. Please try again.</p>
      `;
    }

    // Cart functions
    function addToCart(chef, item) {
      window.CartService.addItem({
        chefId: chef.id,
        chefName: chef.name,
        chefSlug: chef.slug,
        itemId: item.id || item.name,
        itemName: item.name,
        price: item.price,
        prepTime: item.prepTime || 15,
        quantity: 1
      });

      // Show feedback
      updateCartPreview();
      
      // Optional: Show toast notification
      showToast(`Added ${item.name} to cart`);
    }

    function updateCartPreview() {
      const count = window.CartService.getCount();
      const total = window.CartService.getTotal();
      
      const cartPreview = document.getElementById('cart-preview');
      const cartPreviewCount = document.getElementById('cart-preview-count');
      const cartPreviewTotal = document.getElementById('cart-preview-total');
      
      if (count > 0) {
        cartPreview.style.display = 'block';
        cartPreviewCount.textContent = count;
        cartPreviewTotal.textContent = total.toFixed(2);
      } else {
        cartPreview.style.display = 'none';
      }
    }

    function showToast(message) {
      // Create toast element
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: var(--teal);
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 10000;
        animation: slideIn 0.3s ease-out;
      `;
      toast.textContent = `‚úì ${message}`;
      
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.animation = 'slideOut 0.3s ease-out';
        setTimeout(() => toast.remove(), 300);
      }, 2000);
    }

    // Listen for cart changes
    window.addEventListener('cartChanged', updateCartPreview);
    
    // Initial cart preview update
    updateCartPreview();

  })();
</script>

<style>
  @keyframes slideIn {
    from { transform: translateX(400px); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
  @keyframes slideOut {
    from { transform: translateX(0); opacity: 1; }
    to { transform: translateX(400px); opacity: 0; }
  }
</style>
