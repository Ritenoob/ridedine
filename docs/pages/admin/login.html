<!-- Admin Login Page -->
<div class="admin-login-container">
  <div class="login-card">
    <h1>üîê Admin Login</h1>
    <p class="login-subtitle">Enter your credentials to access the admin dashboard</p>
    
    <div class="error-message" id="errorMessage"></div>

    <form id="loginForm">
      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" name="email" required autocomplete="email" value="admin@ridendine.com" />
      </div>

      <div class="form-group">
        <label for="password">Password</label>
        <input type="password" id="password" name="password" required autocomplete="current-password" />
      </div>

      <button type="submit" class="button button--primary" style="width: 100%;">
        Login to Admin Dashboard
      </button>
    </form>

    <div style="margin-top: 20px; text-align: center;">
      <a href="#" onclick="navigateTo('/'); return false;" style="color: #667eea; text-decoration: none;">‚Üê Back to Home</a>
    </div>
  </div>
</div>

<style>
  .admin-login-container {
    padding: 32px;
    max-width: 500px;
    margin: 60px auto;
    min-height: 100vh;
  }
  .login-card {
    background: #ffffff;
    border-radius: 20px;
    padding: 40px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
  }
  .login-card h1 {
    margin-top: 0;
    margin-bottom: 8px;
    color: #1a202c;
  }
  .login-subtitle {
    color: #718096;
    margin-bottom: 32px;
  }
  .form-group {
    margin-bottom: 20px;
  }
  .form-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 8px;
    color: #2d3748;
  }
  .form-group input {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    font-size: 16px;
    transition: border-color 0.2s;
  }
  .form-group input:focus {
    outline: none;
    border-color: #667eea;
  }
  .error-message {
    color: #e53e3e;
    background: #fff5f5;
    padding: 12px 16px;
    border-radius: 8px;
    margin-bottom: 20px;
    display: none;
  }
  .error-message.visible {
    display: block;
  }
</style>

<script>
(async function() {
  const loginForm = document.getElementById('loginForm');
  const errorMessage = document.getElementById('errorMessage');
  const passwordInput = document.getElementById('password');
  const emailInput = document.getElementById('email');

  // Check if already authenticated
  const existingToken = localStorage.getItem('auth_token');
  if (existingToken) {
    try {
      const sessionRes = await window.apiFetch('/api/auth/session');
      const sessionData = await sessionRes.json();
      if (sessionData.success && sessionData.data?.authenticated && sessionData.data?.user?.role === 'admin') {
        navigateTo('/admin');
        return;
      }
    } catch (error) {
      localStorage.removeItem('auth_token');
      localStorage.removeItem('auth_user');
    }
  }

  loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    errorMessage.classList.remove('visible');
    errorMessage.textContent = '';

    const email = emailInput.value;
    const password = passwordInput.value;

    try {
      const res = await window.apiFetch('/api/auth/login', {
        method: 'POST',
        body: { email, password, role: 'admin' }
      });

      const data = await res.json();

      if (!data.success) {
        const errorMsg = data.error?.message || 'Login failed';
        throw new Error(errorMsg);
      }

      // Store JWT token and user info
      localStorage.setItem('auth_token', data.data.token);
      localStorage.setItem('auth_user', JSON.stringify(data.data.user));
      
      // Redirect to admin dashboard
      const redirectPath = data.data.redirect || '/admin';
      navigateTo(redirectPath);
    } catch (error) {
      errorMessage.textContent = error.message || 'Login failed. Please check your credentials.';
      errorMessage.classList.add('visible');
      passwordInput.value = '';
      passwordInput.focus();
    }
  });
})();
</script>
