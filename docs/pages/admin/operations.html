<!-- Operations Dashboard -->
<div class="admin-layout">
  <aside class="admin-sidebar">
    <div class="admin-brand">
      <h2>ðŸ” Admin Portal</h2>
    </div>
    <nav class="admin-nav">
      <a href="#" onclick="navigateTo('/admin'); return false;">ðŸ“Š Dashboard</a>
      <a href="#" onclick="navigateTo('/admin/customers'); return false;">ðŸ‘¥ Customers</a>
      <a href="#" onclick="navigateTo('/admin/drivers'); return false;">ðŸš— Drivers</a>
      <a href="#" onclick="navigateTo('/admin/operations'); return false;" class="active">ðŸ“¦ Operations</a>
      <a href="#" onclick="navigateTo('/admin/payouts'); return false;">ðŸ’° Payouts</a>
      <a href="#" onclick="navigateTo('/admin/disputes'); return false;">âš ï¸ Disputes</a>
      <a href="#" onclick="navigateTo('/admin/integrations'); return false;">ðŸ”Œ Integrations</a>
      <a href="#" onclick="navigateTo('/admin/live-map'); return false;">ðŸ—ºï¸ Live Map</a>
      <a href="#" onclick="navigateTo('/admin/driver-simulator'); return false;">ðŸŽ® Simulator</a>
      <hr style="border: none; border-top: 1px solid #e2e8f0; margin: 12px 0;">
      <a href="#" onclick="navigateTo('/admin/legal/terms'); return false;">ðŸ“„ Terms</a>
      <a href="#" onclick="navigateTo('/admin/legal/privacy'); return false;">ðŸ”’ Privacy</a>
    </nav>
  </aside>

  <main class="admin-main">
    <header class="admin-header">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; base-uri 'self'; object-src 'none'; img-src 'self' data: https:; style-src 'self' 'unsafe-inline' https://unpkg.com; script-src 'self' 'unsafe-inline' https://unpkg.com; connect-src 'self' https://ridendine-demo.onrender.com; font-src 'self' data: https:;">
      <h1>Operations Dashboard</h1>
      <button id="logoutBtn" class="button">Logout</button>
    </header>

    <div class="admin-content">
      <div class="metric-grid" style="margin-bottom: 24px;">
        <div class="metric-card">
          <div class="metric-label">Active Orders</div>
          <div class="metric-value" id="activeOrders">-</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">In Delivery</div>
          <div class="metric-value" style="color: var(--orange);" id="inDelivery">-</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Completed Today</div>
          <div class="metric-value" style="color: #48bb78;" id="completedToday">-</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Avg Delivery Time</div>
          <div class="metric-value" style="font-size: 1.5rem;">24 min</div>
        </div>
      </div>

      <div class="operations-grid">
        <div class="ops-card">
          <h3>ðŸšš Delivery Metrics</h3>
          <div class="metric-row">
            <span>On-time Deliveries</span>
            <strong>94.5%</strong>
          </div>
          <div class="metric-row">
            <span>Average Distance</span>
            <strong>4.2 mi</strong>
          </div>
          <div class="metric-row">
            <span>Peak Hours</span>
            <strong>6-8 PM</strong>
          </div>
        </div>

        <div class="ops-card">
          <h3>ðŸ“Š Order Stats</h3>
          <div class="metric-row">
            <span>Total Orders Today</span>
            <strong id="totalToday">-</strong>
          </div>
          <div class="metric-row">
            <span>Revenue Today</span>
            <strong>$1,245.50</strong>
          </div>
          <div class="metric-row">
            <span>Avg Order Value</span>
            <strong>$32.40</strong>
          </div>
        </div>

        <div class="ops-card">
          <h3>ðŸŽ¯ Performance</h3>
          <div class="metric-row">
            <span>Customer Satisfaction</span>
            <strong>4.7 â­</strong>
          </div>
          <div class="metric-row">
            <span>Order Accuracy</span>
            <strong>98.2%</strong>
          </div>
          <div class="metric-row">
            <span>Cancellation Rate</span>
            <strong>1.3%</strong>
          </div>
        </div>
      </div>

      <div class="quick-links" style="margin-top: 32px;">
        <h3>Quick Access</h3>
        <div class="link-grid">
          <button class="link-card" onclick="navigateTo('/admin/live-map')">
            <span style="font-size: 2rem;">ðŸ—ºï¸</span>
            <span>Live Map</span>
            <small>Track deliveries in real-time</small>
          </button>
          <button class="link-card" onclick="navigateTo('/admin/drivers')">
            <span style="font-size: 2rem;">ðŸš—</span>
            <span>Drivers</span>
            <small>Manage driver fleet</small>
          </button>
          <button class="link-card" onclick="navigateTo('/admin/customers')">
            <span style="font-size: 2rem;">ðŸ‘¥</span>
            <span>Customers</span>
            <small>View customer data</small>
          </button>
          <button class="link-card" onclick="navigateTo('/admin/disputes')">
            <span style="font-size: 2rem;">âš ï¸</span>
            <span>Disputes</span>
            <small>Handle issues</small>
          </button>
        </div>
      </div>
    </div>
  </main>
</div>

<style>
  .admin-layout { display: flex; min-height: 100vh; }
  .admin-sidebar { width: 250px; background: #1a202c; color: white; padding: 20px; position: fixed; height: 100vh; overflow-y: auto; }
  .admin-brand h2 { margin: 0 0 24px 0; font-size: 1.2rem; }
  .admin-nav { display: flex; flex-direction: column; gap: 4px; }
  .admin-nav a { padding: 10px 12px; border-radius: 6px; color: #cbd5e0; transition: all 0.2s; }
  .admin-nav a:hover, .admin-nav a.active { background: #2d3748; color: white; }
  .admin-main { margin-left: 250px; flex: 1; background: var(--sand); }
  .admin-header { background: white; padding: 20px 32px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; }
  .admin-header h1 { margin: 0; }
  .admin-content { padding: 32px; }
  .metric-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; }
  .metric-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
  .metric-label { font-size: 0.875rem; color: #718096; margin-bottom: 8px; }
  .metric-value { font-size: 2rem; font-weight: bold; color: var(--teal); }
  .operations-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px; }
  .ops-card { background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
  .ops-card h3 { margin-top: 0; }
  .metric-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #e2e8f0; }
  .metric-row:last-child { border-bottom: none; }
  .link-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; }
  .link-card { display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 20px; background: white; border: 2px solid #e2e8f0; border-radius: 12px; cursor: pointer; transition: all 0.2s; }
  .link-card:hover { border-color: var(--teal); transform: translateY(-2px); }
  .link-card small { color: #718096; font-size: 0.75rem; text-align: center; }
</style>

<script>
(async function() {
  // Check admin authentication
  try {
    const res = await window.apiFetch('/api/auth/session');
    const data = await res.json();
    if (!data.authenticated || data.role !== 'admin') {
      navigateTo('/admin/login');
      return;
    }
  } catch (error) {
    navigateTo('/admin/login');
    return;
  }

  // Fetch orders for metrics
  async function loadMetrics() {
    try {
      const res = await window.apiFetch('/api/orders');
      const orders = await res.json();

      const today = new Date();
      today.setHours(0, 0, 0, 0);

      const todayOrders = orders.filter(o => new Date(o.createdAt) >= today);
      const active = orders.filter(o => ['pending', 'confirmed', 'preparing'].includes(o.status));
      const inDelivery = orders.filter(o => o.status === 'out_for_delivery');
      const completed = todayOrders.filter(o => o.status === 'delivered');

      document.getElementById('activeOrders').textContent = active.length;
      document.getElementById('inDelivery').textContent = inDelivery.length;
      document.getElementById('completedToday').textContent = completed.length;
      document.getElementById('totalToday').textContent = todayOrders.length;
    } catch (error) {
      console.error('Failed to fetch metrics:', error);
    }
  }

  // Logout
  document.getElementById('logoutBtn').addEventListener('click', async () => {
    await window.apiFetch('/api/auth/logout', { method: 'POST' });
    navigateTo('/');
  });

  loadMetrics();
})();
</script>


