<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; base-uri 'self'; object-src 'none'; img-src 'self' data: https:; style-src 'self' 'unsafe-inline' https://unpkg.com; script-src 'self' 'unsafe-inline' https://unpkg.com; connect-src 'self' https://ridendine-demo.onrender.com; font-src 'self' data: https:;">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RIDENDINE | Delivery Sales Tracking Dashboard</title>
  
  <!-- Dynamic Base Path Detection for GitHub Pages -->
  <script>
    // Detect and set base href for proper asset loading on GitHub Pages
    (function() {
      const hostname = window.location.hostname;
      const pathname = window.location.pathname;
      
      let basePath = '/'; // Default to root for all deployments
      
      // Check if this is GitHub Pages deployment
      if (hostname.endsWith('.github.io')) {
        // Extract repo name from pathname (first segment)
        const pathSegments = pathname.split('/').filter(segment => segment.length > 0);
        
        // Common file extensions to exclude
        const fileExtensions = ['.html', '.js', '.css', '.json', '.png', '.jpg', '.jpeg', '.gif', '.svg', '.ico', '.woff', '.woff2', '.ttf', '.eot', '.webmanifest', '.map'];
        
        // If we have a path segment and it doesn't end with a file extension, use it as base path
        if (pathSegments.length > 0) {
          const firstSegment = pathSegments[0];
          const isFile = fileExtensions.some(ext => firstSegment.endsWith(ext));
          
          if (!isFile) {
            basePath = '/' + firstSegment + '/';
          }
        }
      }
      
      // Always create and insert base tag
      const base = document.createElement('base');
      base.href = basePath;
      document.head.appendChild(base);
      
      console.log('[RideNDine] Base path set to:', basePath);
    })();
  </script>
  
  <!-- Icons & Manifest -->
  <link rel="icon" href="./assets/logo.svg" type="image/svg+xml" />
  <link rel="apple-touch-icon" href="./assets/logo.svg" />
  <link rel="manifest" href="./manifest.webmanifest" />
  <meta name="theme-color" content="#ff7a18" />
  
  <!-- Preconnect for performance -->
  <link rel="preconnect" href="https://unpkg.com" />
  
  <!-- Leaflet CSS (for map pages) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  
  <!-- Main Styles -->
  <link rel="stylesheet" href="./ui.css" />
  <link rel="stylesheet" href="./layout.css" />
  <link rel="stylesheet" href="./styles.css" />
  
  <!-- Meta Description -->
  <meta name="description" content="RIDENDINE is a professional delivery sales tracking dashboard connecting home chefs with customers across Hamilton. Order fresh, home-cooked meals for delivery." />
  
  <!-- Open Graph / Social -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="RIDENDINE | Delivery Sales Tracking Dashboard" />
  <meta property="og:description" content="Professional delivery sales tracking platform for home chefs, featuring real-time order management, route optimization, and integrated payments." />
  
  <style>
    /* Loading Spinner */
    .loading-spinner {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 9999;
    }
    
    .loading-spinner.active {
      display: block;
    }
    
    .spinner {
      border: 4px solid rgba(255, 122, 24, 0.1);
      border-left-color: #ff7a18;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 10001;
      display: none;
      animation: slideIn 0.3s ease;
    }
    
    .toast.show {
      display: block;
    }
    
    .toast.error {
      background: rgba(220, 38, 38, 0.95);
    }
    
    .toast.warning {
      background: rgba(245, 158, 11, 0.95);
    }
    
    .toast.success {
      background: rgba(34, 197, 94, 0.95);
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    /* App Container */
    #app {
      min-height: 100vh;
    }
  </style>
</head>
<body>
  <!-- Loading Spinner -->
  <div id="loading-spinner" class="loading-spinner">
    <div class="spinner"></div>
  </div>
  
  <!-- Toast Notification -->
  <div id="toast" class="toast"></div>
  
  <!-- Main App Container (pages load here) -->
  <div id="app">
    <!-- Initial loading state -->
    <div style="display: flex; align-items: center; justify-content: center; min-height: 100vh;">
      <div class="spinner"></div>
    </div>
  </div>
  
  <!-- Leaflet JS (for map pages) -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>
  
  <!-- Core Scripts -->
  <script src="/config.js"></script>
  <script src="/data/demo-data.js"></script>
  <script src="/js/api-base.js"></script>
  <script src="/js/env-banner.js"></script>
  <script src="/components/bottom-nav.js"></script>
  <script src="/js/payments.js"></script>
  <script src="/services/cart.js"></script>
  <script src="/services/chefs.js"></script>
  <script src="/layout.js"></script>
  <script src="/auth-client.js"></script>
  <script src="/router.js"></script>
  <script src="/routes.js"></script>
  
  <script>
    // Global error handler
    window.addEventListener('error', function(e) {
      console.error('Global error:', e.error);
    });
    
    // Global loading indicator helpers
    window.showLoading = function() {
      const spinner = document.getElementById('loading-spinner');
      if (spinner) spinner.classList.add('active');
    };
    
    window.hideLoading = function() {
      const spinner = document.getElementById('loading-spinner');
      if (spinner) spinner.classList.remove('active');
    };
    
    // Toast notification helper
    window.showToast = function(message, type = 'info', duration = 4000) {
      const toast = document.getElementById('toast');
      if (!toast) return;
      
      toast.textContent = message;
      toast.className = 'toast show ' + type;
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, duration);
    };
    
    // Backend connectivity checker
    let backendCheckAttempts = 0;
    window.checkBackendConnectivity = async function() {
      try {
        const response = await window.apiFetch('/api/health', {
          method: 'GET',
          headers: { 'Content-Type': 'application/json' }
        });
        
        if (response.ok) {
          backendCheckAttempts = 0; // Reset on success
          return true;
        } else {
          throw new Error('Backend returned non-200 status');
        }
      } catch (error) {
        backendCheckAttempts++;
        
        // Only show toast on first failure or every 5 attempts
        if (backendCheckAttempts === 1 || backendCheckAttempts % 5 === 0) {
          window.showToast('âš ï¸ Backend temporarily unavailable', 'warning', 5000);
        }
        
        console.warn('Backend connectivity check failed:', error);
        return false;
      }
    };
    
    // Initial backend check on load
    window.addEventListener('DOMContentLoaded', function() {
      window.checkBackendConnectivity();
    });
  </script>
</body>
</html>


