<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RideNDine - Deployment Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      line-height: 1.6;
    }
    h1 { color: #ff7a18; }
    .test-section {
      background: #f5f5f5;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
    }
    .pass { color: #28a745; font-weight: bold; }
    .fail { color: #dc3545; font-weight: bold; }
    .info { color: #17a2b8; }
    pre {
      background: #fff;
      padding: 10px;
      border-left: 3px solid #ff7a18;
      overflow-x: auto;
    }
    button {
      background: #ff7a18;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin: 5px;
    }
    button:hover {
      background: #e66910;
    }
  </style>
</head>
<body>
  <h1>ðŸš€ RideNDine Deployment Test Suite</h1>
  
  <div class="test-section">
    <h2>Environment Detection</h2>
    <p><strong>Current Hostname:</strong> <span id="hostname"></span></p>
    <p><strong>Current Pathname:</strong> <span id="pathname"></span></p>
    <p><strong>Detected as GitHub Pages:</strong> <span id="is-github-pages"></span></p>
    <p><strong>Full URL:</strong> <span id="full-url"></span></p>
  </div>

  <div class="test-section">
    <h2>Configuration Tests</h2>
    <div id="config-tests">
      <p>Loading configuration...</p>
    </div>
  </div>

  <div class="test-section">
    <h2>Router Tests</h2>
    <div id="router-tests">
      <p>Testing router...</p>
    </div>
  </div>

  <div class="test-section">
    <h2>Auth Client Tests</h2>
    <div id="auth-tests">
      <p>Testing authentication client...</p>
    </div>
  </div>

  <div class="test-section">
    <h2>Asset Loading Tests</h2>
    <div id="asset-tests">
      <p>Testing asset paths...</p>
    </div>
  </div>

  <div class="test-section">
    <h2>Quick Actions</h2>
    <button onclick="window.location.href='./index.html'">Load Main App</button>
    <button onclick="window.location.href='./customer'">Test Customer Route</button>
    <button onclick="window.location.href='./admin'">Test Admin Route</button>
  </div>

  <script>
    // Display environment info
    document.getElementById('hostname').textContent = window.location.hostname;
    document.getElementById('pathname').textContent = window.location.pathname;
    document.getElementById('full-url').textContent = window.location.href;
    
    const isGitHubPages = window.location.hostname.endsWith('.github.io');
    document.getElementById('is-github-pages').innerHTML = isGitHubPages 
      ? '<span class="pass">YES âœ“</span>' 
      : '<span class="info">NO (Local/Custom Domain)</span>';

    // Test configuration
    async function testConfiguration() {
      const container = document.getElementById('config-tests');
      try {
        // Load config.js
        await loadScript('./config.js');
        
        if (window.RideNDineConfig) {
          container.innerHTML = `
            <p class="pass">âœ“ Configuration loaded successfully</p>
            <pre>${JSON.stringify(window.RideNDineConfig, null, 2)}</pre>
          `;
        } else {
          container.innerHTML = '<p class="fail">âœ— Configuration not loaded</p>';
        }
      } catch (error) {
        container.innerHTML = `<p class="fail">âœ— Error loading configuration: ${error.message}</p>`;
      }
    }

    // Test router
    async function testRouter() {
      const container = document.getElementById('router-tests');
      try {
        // Load router.js
        await loadScript('./router.js');
        
        if (window.Router) {
          const basePath = window.Router.basePath || '(empty string)';
          container.innerHTML = `
            <p class="pass">âœ“ Router loaded successfully</p>
            <p><strong>Detected Base Path:</strong> <code>${basePath}</code></p>
            <p class="info">This should be <code>/ridendine-demo</code> on GitHub Pages or empty on localhost</p>
          `;
        } else {
          container.innerHTML = '<p class="fail">âœ— Router not loaded</p>';
        }
      } catch (error) {
        container.innerHTML = `<p class="fail">âœ— Error loading router: ${error.message}</p>`;
      }
    }

    // Test auth client
    async function testAuthClient() {
      const container = document.getElementById('auth-tests');
      try {
        // Load auth-client.js
        await loadScript('./auth-client.js');
        
        if (window.AuthClient) {
          const hasBackend = window.AuthClient.hasBackend();
          const apiBaseUrl = window.AuthClient.getApiBaseUrl() || '(null - no backend)';
          
          // Try to check session
          let sessionResult = 'Not tested';
          try {
            const session = await window.AuthClient.checkSession();
            sessionResult = JSON.stringify(session, null, 2);
          } catch (error) {
            sessionResult = `Error: ${error.message}`;
          }
          
          container.innerHTML = `
            <p class="pass">âœ“ Auth client loaded successfully</p>
            <p><strong>Has Backend:</strong> ${hasBackend ? '<span class="pass">YES</span>' : '<span class="info">NO (Static Demo Mode)</span>'}</p>
            <p><strong>API Base URL:</strong> <code>${apiBaseUrl}</code></p>
            <p><strong>Session Check Result:</strong></p>
            <pre>${sessionResult}</pre>
          `;
        } else {
          container.innerHTML = '<p class="fail">âœ— Auth client not loaded</p>';
        }
      } catch (error) {
        container.innerHTML = `<p class="fail">âœ— Error loading auth client: ${error.message}</p>`;
      }
    }

    // Test asset loading
    async function testAssets() {
      const container = document.getElementById('asset-tests');
      const assets = [
        { url: './styles.css', type: 'CSS' },
        { url: './layout.css', type: 'CSS' },
        { url: './ui.css', type: 'CSS' },
        { url: './layout.js', type: 'JS' },
        { url: './routes.js', type: 'JS' },
      ];
      
      let results = '<p>Testing asset accessibility...</p><ul>';
      
      for (const asset of assets) {
        try {
          const response = await fetch(asset.url, { method: 'HEAD' });
          if (response.ok) {
            results += `<li class="pass">âœ“ ${asset.type}: ${asset.url} - Accessible</li>`;
          } else {
            results += `<li class="fail">âœ— ${asset.type}: ${asset.url} - Status ${response.status}</li>`;
          }
        } catch (error) {
          results += `<li class="fail">âœ— ${asset.type}: ${asset.url} - Error: ${error.message}</li>`;
        }
      }
      
      results += '</ul>';
      container.innerHTML = results;
    }

    // Helper to load scripts
    function loadScript(src) {
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = src;
        script.onload = resolve;
        script.onerror = reject;
        document.head.appendChild(script);
      });
    }

    // Run all tests
    (async function runTests() {
      await testConfiguration();
      await testRouter();
      await testAuthClient();
      await testAssets();
    })();
  </script>
</body>
</html>
