# Environment Variables - RIDENDINE

Complete list of environment variables for the RIDENDINE platform.

## Required Variables

### DEMO_MODE
- **Type**: Boolean (true/false)
- **Default**: false
- **Description**: Enable demo mode to bypass authentication
- **Usage**:
  - `true`: No password required, role selection at login
  - `false`: Email/password authentication required
- **Example**: `DEMO_MODE=true`

### PORT
- **Type**: Number
- **Default**: 3000
- **Description**: Port for the Express server
- **Example**: `PORT=8080`
- **Note**: Render/Railway set this automatically

### NODE_ENV
- **Type**: String (development/production)
- **Default**: development
- **Description**: Application environment
- **Example**: `NODE_ENV=production`

## Database Configuration

### DATABASE_URL
- **Type**: String (PostgreSQL connection URL)
- **Default**: None (uses in-memory fallback)
- **Description**: PostgreSQL database connection string
- **Format**: `postgresql://username:password@host:port/database`
- **Example**: 
  ```
  DATABASE_URL=postgresql://ridendine:ridendine_dev_password@localhost:5432/ridendine
  ```
- **Production**: Render/Heroku provide this automatically when you add PostgreSQL
- **Note**: Server falls back to in-memory mode if not configured

## Authentication

### ADMIN_PASSWORD
- **Type**: String
- **Default**: Admin0123
- **Description**: Password for admin role login
- **Example**: `ADMIN_PASSWORD=YourSecurePassword123`
- **Note**: Used when DEMO_MODE=false

### CHEF_PASSWORD
- **Type**: String
- **Default**: chef123
- **Description**: Password for chef role login
- **Example**: `CHEF_PASSWORD=ChefPass123`

### DRIVER_PASSWORD
- **Type**: String
- **Default**: driver123
- **Description**: Password for driver role login
- **Example**: `DRIVER_PASSWORD=DriverPass123`

### SESSION_SECRET
- **Type**: String
- **Default**: None (optional for future JWT implementation)
- **Description**: Secret key for session encryption
- **Example**: `SESSION_SECRET=your-random-32-character-string`

## CORS Configuration

### GITHUB_PAGES_ORIGIN
- **Type**: String (URL)
- **Default**: None
- **Description**: GitHub Pages origin for CORS
- **Example**: `GITHUB_PAGES_ORIGIN=https://seancfafinlay.github.io`
- **Required**: For GitHub Pages deployment
- **Note**: Must match exact origin of frontend

## Rate Limiting

### DISABLE_RATE_LIMIT
- **Type**: Boolean (true/false)
- **Default**: false
- **Description**: Disable API rate limiting
- **Example**: `DISABLE_RATE_LIMIT=true`
- **Usage**:
  - `true`: No rate limiting (development/testing)
  - `false`: 100 requests per 15 minutes per IP

## Payment Integration (Stripe)

### STRIPE_SECRET_KEY
- **Type**: String
- **Default**: None
- **Description**: Stripe secret API key
- **Format**: `sk_test_...` (test) or `sk_live_...` (production)
- **Example**: `STRIPE_SECRET_KEY=sk_test_51ABC...`
- **Required**: For real payment processing
- **Fallback**: Mock payments in demo mode

### STRIPE_PUBLISHABLE_KEY
- **Type**: String
- **Default**: None
- **Description**: Stripe publishable API key
- **Format**: `pk_test_...` (test) or `pk_live_...` (production)
- **Example**: `STRIPE_PUBLISHABLE_KEY=pk_test_51ABC...`
- **Note**: Exposed to frontend via /api/config

### STRIPE_WEBHOOK_SECRET
- **Type**: String
- **Default**: None
- **Description**: Stripe webhook signing secret
- **Format**: `whsec_...`
- **Example**: `STRIPE_WEBHOOK_SECRET=whsec_ABC123...`
- **Note**: Used to verify Stripe webhook events

## External Integrations (Optional)

### APP_BASE_URL
- **Type**: String (URL)
- **Default**: http://localhost:3000
- **Description**: Base URL of the application
- **Example**: `APP_BASE_URL=https://ridendine-demo.onrender.com`
- **Usage**: For generating redirects, webhooks URLs

### COOCO_WEBHOOK_SECRET
- **Type**: String
- **Default**: None
- **Description**: Secret for Cooco meal plan webhook
- **Example**: `COOCO_WEBHOOK_SECRET=your_cooco_secret`

### MEALBRIDGE_API_KEY
- **Type**: String
- **Default**: None
- **Description**: API key for Mealbridge integration
- **Example**: `MEALBRIDGE_API_KEY=your_mealbridge_key`

### MEALBRIDGE_BASE_URL
- **Type**: String (URL)
- **Default**: https://api.mealbridge.com
- **Description**: Mealbridge API base URL
- **Example**: `MEALBRIDGE_BASE_URL=https://api.mealbridge.com`

---

## Environment Presets

### Local Development (.env)
```bash
# Core
DEMO_MODE=true
DISABLE_RATE_LIMIT=true
PORT=3000
NODE_ENV=development

# Database (optional - will fallback to in-memory)
DATABASE_URL=postgresql://ridendine:ridendine_dev_password@localhost:5432/ridendine

# Auth
ADMIN_PASSWORD=Admin0123
CHEF_PASSWORD=chef123
DRIVER_PASSWORD=driver123

# CORS (not needed for localhost same-origin)
# GITHUB_PAGES_ORIGIN=
```

### Render Production (.env)
```bash
# Core
DEMO_MODE=true
DISABLE_RATE_LIMIT=true
NODE_ENV=production

# Database (Render provides this automatically)
DATABASE_URL=<auto-generated-by-render>

# Auth
ADMIN_PASSWORD=Admin0123

# CORS (required for GitHub Pages frontend)
GITHUB_PAGES_ORIGIN=https://seancfafinlay.github.io

# Optional: Payments
STRIPE_SECRET_KEY=sk_test_...
STRIPE_PUBLISHABLE_KEY=pk_test_...
STRIPE_WEBHOOK_SECRET=whsec_...
```

### Production (Real Deployment)
```bash
# Core
DEMO_MODE=false
DISABLE_RATE_LIMIT=false
NODE_ENV=production

# Database
DATABASE_URL=<production-postgresql-url>

# Auth (use strong passwords)
ADMIN_PASSWORD=<strong-random-password>
CHEF_PASSWORD=<strong-random-password>
DRIVER_PASSWORD=<strong-random-password>
SESSION_SECRET=<32-char-random-string>

# CORS
GITHUB_PAGES_ORIGIN=https://yourdomain.com

# Payments (real keys)
STRIPE_SECRET_KEY=sk_live_...
STRIPE_PUBLISHABLE_KEY=pk_live_...
STRIPE_WEBHOOK_SECRET=whsec_...

# App
APP_BASE_URL=https://api.yourdomain.com
```

---

## Setting Environment Variables

### Local (.env file)
```bash
# 1. Copy example file
copy .env.example .env

# 2. Edit .env with your values
notepad .env

# 3. Variables are loaded automatically via dotenv
```

### Render (Dashboard)
```bash
# 1. Go to your Render service
# 2. Click "Environment" tab
# 3. Add each variable:
#    - Click "Add Environment Variable"
#    - Key: DEMO_MODE
#    - Value: true
#    - Click "Save Changes"

# 4. Render will auto-redeploy
```

### GitHub Actions (Secrets)
```bash
# 1. Go to repository Settings â†’ Secrets
# 2. Click "New repository secret"
# 3. Add each secret (no quotes)
# 4. Use in workflow:
#    env:
#      DEMO_MODE: ${{ secrets.DEMO_MODE }}
```

---

## Validation

Test your environment variables are loaded:

```bash
# Health check endpoint shows env status
curl https://your-api.com/api/health

# Response includes:
{
  "status": "ok",
  "demoMode": true,
  "demoModeRaw": "true",
  "database": "connected",
  "timestamp": "..."
}
```

---

## Security Best Practices

1. **Never commit .env files**
   - Already in .gitignore
   - Use .env.example for templates

2. **Use strong passwords in production**
   - Minimum 12 characters
   - Mix of letters, numbers, symbols
   - Use password generator

3. **Rotate secrets regularly**
   - Change passwords every 90 days
   - Rotate API keys on schedule

4. **Separate test/production credentials**
   - Never use production keys in development
   - Use Stripe test keys for development

5. **Limit access**
   - Only share credentials with team members who need them
   - Use Render/Heroku team features for collaboration

---

## Troubleshooting

**"Cannot connect to database"**
- Check DATABASE_URL format
- Ensure PostgreSQL is running
- Server will fallback to in-memory mode

**"CORS error from GitHub Pages"**
- Set GITHUB_PAGES_ORIGIN correctly
- Must match exact origin (no trailing slash)
- Restart server after changing

**"Too many requests"**
- Set DISABLE_RATE_LIMIT=true for development
- In production, rate limit is per IP

**"Invalid credentials"**
- Check ADMIN_PASSWORD in .env
- Ensure no extra quotes or spaces
- In DEMO_MODE, password may not be required

---

## Master Admin Account

**The master admin account works regardless of DEMO_MODE setting:**

- Email: `sean@seanfinlay.ca`
- Password: `Admin0123`
- Role: `admin`

This account is hardcoded in the auth route for guaranteed access.
